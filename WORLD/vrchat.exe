#!/usr/bin/python

import sys
from urllib.parse import unquote
import re
import os

arg = ' '.join(sys.argv[1:])

proton_location = "$HOME/.steam/steam/steamapps/common/Proton\ -\ Experimental"
vrchat_location = "$HOME/.steam/steam/steamapps/common/VRChat"

#f = open('/tmp/vrchatrun.txt', 'w')

url = unquote(arg)

if('/tmp/' in url):
    url = url.replace('file:////','file://Z:/')
    url = url.replace('/','\\')
    url = url.replace('file:\\\\','file://')
else:
    url = re.sub(r"////.*drive_c/", '//C:/', url)
    url = url.replace('/','\\')
    url = url.replace('file:\\\\','file://')

url = url.replace("--url=", "--url='")
url = url.replace("vrcw ", "vrcw' ")

#f.write('STEAM_COMPAT_CLIENT_INSTALL_PATH="$HOME/.steam/steam" STEAM_COMPAT_DATA_PATH=~/.steam/steam/steamapps/compatdata/438100 {proton}/proton run {vrchat}/VRChat.exe {launch_args}'.format(proton=proton_location, vrchat=vrchat_location, launch_args=url))
#f.close()
os.system('STEAM_COMPAT_CLIENT_INSTALL_PATH="$HOME/.steam/steam" STEAM_COMPAT_DATA_PATH={vrchat}/../../compatdata/438100 {proton}/proton run {vrchat}/VRChat.exe {launch_args}'.format(proton=proton_location, vrchat=vrchat_location, launch_args=url))
